<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>
      {{ isEdicao ? "Editar Dados do Cliente" : "Cadastro de Cliente" }}
    </ion-title>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/"></ion-back-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <div *ngIf="carregando" class="loading-container">
    <ion-spinner name="circular"></ion-spinner>
    <ion-text>
      <p>Carregando...</p>
    </ion-text>
  </div>

  <form
    [formGroup]="clienteForm"
    (ngSubmit)="onSubmit()"
    *ngIf="!carregando"
  >
    <ion-card>
      <ion-card-header>
        <ion-card-title>Dados Pessoais</ion-card-title>
      </ion-card-header>
      
      <ion-card-content>
        <ion-item>
          <ion-label position="stacked">Nome Completo *</ion-label>
          <ion-input
            type="text"
            formControlName="nome"
            placeholder="Digite o nome completo"
            [class.ion-invalid]="isFieldInvalid('nome')"
            [class.ion-touched]="clienteForm.get('nome')?.touched"
          ></ion-input>
        </ion-item>
        <ion-text color="danger" *ngIf="isFieldInvalid('nome')">
          <small>{{ getErrorMessage("nome") }}</small>
        </ion-text>

        <ion-item>
          <ion-label position="stacked">Telefone *</ion-label>

          <ion-input
            type="tel"
            formControlName="telefone"
            placeholder="(00) 00000-0000"
            maxlength="15"
            (ionInput)="onTelefoneChange($event)"
            [class.ion-invalid]="isFieldInvalid('telefone')"
            [class.ion-touched]="clienteForm.get('telefone')?.touched"
          ></ion-input>

        </ion-item>
        <ion-text color="danger" *ngIf="isFieldInvalid('telefone')">
          <small>{{ getErrorMessage("telefone") }}</small>
        </ion-text>
      </ion-card-content>
    </ion-card>

    <ion-card>
      <ion-card-header>
        <ion-card-title>Endereço</ion-card-title>
      </ion-card-header>
      
      <ion-card-content>
        <ion-row>
          <ion-col size="6">
            <ion-item>
              <ion-label position="stacked">CEP *</ion-label>
              <ion-input
                type="text"
                formControlName="cep"
                placeholder="00000-000"
                maxlength="9"
                (ionInput)="onCepChange($event)"
                [class.ion-invalid]="isFieldInvalid('cep')"
                [class.ion-touched]="clienteForm.get('cep')?.touched"
              ></ion-input>
            </ion-item>
            <ion-text color="danger" *ngIf="isFieldInvalid('cep')">
              <small>{{ getErrorMessage("cep") }}</small>
            </ion-text>
          </ion-col>

          <ion-col size="6">
            <ion-item>
              <ion-label position="stacked">Estado *</ion-label>
              <ion-select
                formControlName="estado"
                placeholder="Selecione"
                [class.ion-invalid]="isFieldInvalid('estado')"
                [class.ion-touched]="clienteForm.get('estado')?.touched"
              >
                <ion-select-option value="AC">Acre</ion-select-option>
                <ion-select-option value="AL">Alagoas</ion-select-option>
                <ion-select-option value="AP">Amapá</ion-select-option>
                <ion-select-option value="AM">Amazonas</ion-select-option>
                <ion-select-option value="BA">Bahia</ion-select-option>
                <ion-select-option value="CE">Ceará</ion-select-option>
                <ion-select-option value="DF">Distrito Federal</ion-select-option>
                <ion-select-option value="ES">Espírito Santo</ion-select-option>
                <ion-select-option value="GO">Goiás</ion-select-option>
                <ion-select-option value="MA">Maranhão</ion-select-option>
                <ion-select-option value="MT">Mato Grosso</ion-select-option>
                <ion-select-option value="MS">Mato Grosso do Sul</ion-select-option>
                <ion-select-option value="MG">Minas Gerais</ion-select-option>
                <ion-select-option value="PA">Pará</ion-select-option>
                <ion-select-option value="PB">Paraíba</ion-select-option>
                <ion-select-option value="PR">Paraná</ion-select-option>
                <ion-select-option value="PE">Pernambuco</ion-select-option>
                <ion-select-option value="PI">Piauí</ion-select-option>
                <ion-select-option value="RJ">Rio de Janeiro</ion-select-option>
                <ion-select-option value="RN">Rio Grande do Norte</ion-select-option>
                <ion-select-option value="RS">Rio Grande do Sul</ion-select-option>
                <ion-select-option value="RO">Rondônia</ion-select-option>
                <ion-select-option value="RR">Roraima</ion-select-option>
                <ion-select-option value="SC">Santa Catarina</ion-select-option>
                <ion-select-option value="SP">São Paulo</ion-select-option>
                <ion-select-option value="SE">Sergipe</ion-select-option>
                <ion-select-option value="TO">Tocantins</ion-select-option>
              </ion-select>
            </ion-item>
            <ion-text color="danger" *ngIf="isFieldInvalid('estado')">
              <small>{{ getErrorMessage("estado") }}</small>
            </ion-text>
          </ion-col>
        </ion-row>

        <ion-item>
          <ion-label position="stacked">Endereço *</ion-label>
          <ion-input
            type="text"
            formControlName="endereco"
            placeholder="Digite o endereço completo"
            [class.ion-invalid]="isFieldInvalid('endereco')"
            [class.ion-touched]="clienteForm.get('endereco')?.touched"
          ></ion-input>
        </ion-item>
        <ion-text color="danger" *ngIf="isFieldInvalid('endereco')">
          <small>{{ getErrorMessage("endereco") }}</small>
        </ion-text>

        <ion-row>
          <ion-col size="6">
            <ion-item>
              <ion-label position="stacked">Bairro *</ion-label>
              <ion-input
                type="text"
                formControlName="bairro"
                placeholder="Digite o bairro"
                [class.ion-invalid]="isFieldInvalid('bairro')"
                [class.ion-touched]="clienteForm.get('bairro')?.touched"
              ></ion-input>
            </ion-item>
            <ion-text color="danger" *ngIf="isFieldInvalid('bairro')">
              <small>{{ getErrorMessage("bairro") }}</small>
            </ion-text>
          </ion-col>

          <ion-col size="6">
            <ion-item>
              <ion-label position="stacked">Cidade *</ion-label>
              <ion-input
                type="text"
                formControlName="cidade"
                placeholder="Digite a cidade"
                [class.ion-invalid]="isFieldInvalid('cidade')"
                [class.ion-touched]="clienteForm.get('cidade')?.touched"
              ></ion-input>
            </ion-item>
            <ion-text color="danger" *ngIf="isFieldInvalid('cidade')">
              <small>{{ getErrorMessage("cidade") }}</small>
            </ion-text>
          </ion-col>
        </ion-row>
      </ion-card-content>
    </ion-card>

    <!-- Botões -->
    <ion-row class="ion-padding">
      <ion-col size="6">
        <ion-button
          expand="block"
          fill="outline"
          color="medium"
          (click)="onCancel()"
        >
          <ion-icon name="close" slot="start"></ion-icon>
          Cancelar
        </ion-button>
      </ion-col>
      <ion-col size="6">
        <ion-button
          expand="block"
          type="submit"
          [disabled]="clienteForm.invalid"
          color="primary"
        >
          <ion-icon name="save" slot="start"></ion-icon>
          {{ isEdicao ? "Atualizar Dados" : "Salvar Dados" }}
        </ion-button>
      </ion-col>
    </ion-row>
  </form>
</ion-content>

<style>
.loading-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 200px;
  gap: 16px;
}

ion-card {
  margin: 16px;
}

ion-text[color="danger"] {
  padding-left: 16px;
  display: block;
  margin-top: 4px;
}

ion-item.ion-invalid {
  --border-color: var(--ion-color-danger);
}
</style>